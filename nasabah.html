<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Nasabah</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .content {
            margin-top: 50px;
            padding: 20px;
        }
        .table-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .status-lunas {
            color: green;
            font-weight: bold;
        }
        .status-macet {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container content">
        <h2 class="mb-4 text-center">Daftar Nasabah</h2>
        <div class="table-container">
            <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addModal">Tambah Nasabah</button>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>NO</th>
                        <th>Nama Nasabah</th>
                        <th>Pekerjaan</th>
                        <th>Alamat</th>
                        <th>Pendapatan</th>
                        <th>Jumlah Pinjaman</th>
                        <th>Bunga</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="nasabahTableBody">
                    <!-- Data akan dimuat otomatis dari file Excel -->
                </tbody>
            </table>
        </div>

        <a href="index.html" class="btn btn-primary mt-4">Back to Home</a>
    </div>

    <!-- Modal untuk Tambah Data Nasabah -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addModalLabel">Tambah Data Nasabah</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addForm">
                        <div class="mb-3">
                            <label for="addName" class="form-label">Nama Nasabah</label>
                            <input type="text" class="form-control" id="addName" required>
                        </div>
                        <div class="mb-3">
                            <label for="addJob" class="form-label">Pekerjaan</label>
                            <input type="text" class="form-control" id="addJob" required>
                        </div>
                        <div class="mb-3">
                            <label for="addAddress" class="form-label">Alamat</label>
                            <input type="text" class="form-control" id="addAddress" required>
                        </div>
                        <div class="mb-3">
                            <label for="addIncome" class="form-label">Pendapatan</label>
                            <input type="number" class="form-control" id="addIncome" required>
                        </div>
                        <div class="mb-3">
                            <label for="addLoan" class="form-label">Jumlah Pinjaman</label>
                            <input type="number" class="form-control" id="addLoan" required>
                        </div>
                        <div class="mb-3">
                            <label for="addInterest" class="form-label">Bunga</label>
                            <input type="number" class="form-control" id="addInterest" required>
                        </div>
                        <div class="mb-3">
                            <label for="addStatus" class="form-label">Status</label>
                            <select class="form-select" id="addStatus" required>
                                <option value="Lunas">Lunas</option>
                                <option value="Macet">Macet</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Tambah Nasabah</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal untuk Edit Data Nasabah -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Data Nasabah</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="mb-3">
                            <label for="editName" class="form-label">Nama Nasabah</label>
                            <input type="text" class="form-control" id="editName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editJob" class="form-label">Pekerjaan</label>
                            <input type="text" class="form-control" id="editJob" required>
                        </div>
                        <div class="mb-3">
                            <label for="editAddress" class="form-label">Alamat</label>
                            <input type="text" class="form-control" id="editAddress" required>
                        </div>
                        <div class="mb-3">
                            <label for="editIncome" class="form-label">Pendapatan</label>
                            <input type="number" class="form-control" id="editIncome" required>
                        </div>
                        <div class="mb-3">
                            <label for="editLoan" class="form-label">Jumlah Pinjaman</label>
                            <input type="number" class="form-control" id="editLoan" required>
                        </div>
                        <div class="mb-3">
                            <label for="editInterest" class="form-label">Bunga</label>
                            <input type="number" class="form-control" id="editInterest" required>
                        </div>
                        <div class="mb-3">
                            <label for="editStatus" class="form-label">Status</label>
                            <select class="form-select" id="editStatus" required>
                                <option value="Lunas">Lunas</option>
                                <option value="Macet">Macet</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    <script>
        let nasabahData = []; // Menyimpan data nasabah secara global

        // Fungsi untuk memuat file Excel dan menampilkan data
        function loadExcelData() {
            const url = 'Data Olahan2.xlsx'; // Jalur file Data Olahan.xlsx

            fetch(url)
                .then(response => response.arrayBuffer())
                .then(data => {
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    nasabahData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    displayNasabahData(nasabahData);
                })
                .catch(error => console.error("Error loading Excel file:", error));
        }

        // Fungsi untuk menampilkan data ke tabel HTML
        function displayNasabahData(data) {
            const tbody = document.getElementById('nasabahTableBody');
            tbody.innerHTML = ""; // Kosongkan tabel

            data.slice(1).forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.dataset.index = index + 1; // Menyimpan index baris untuk pengeditan dan penghapusan
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${row[0] || ''}</td>
                    <td>${row[1] || ''}</td>
                    <td>${row[2] || ''}</td>
                    <td>Rp.${row[3] ? row[3].toLocaleString() : ''}</td>
                    <td>Rp.${row[4] ? row[4].toLocaleString() : ''}</td>
                    <td>${row[5] || ''}</td>
                    <td class="${row[6] === 'Lunas' ? 'status-lunas' : 'status-macet'}">${row[6] || ''}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editData(${index})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteData(${index})">Hapus</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Fungsi untuk mengedit data
        function editData(index) {
            const row = nasabahData[index + 1]; // Ambil data dari baris yang dipilih
            document.getElementById('editName').value = row[0];
            document.getElementById('editJob').value = row[1];
            document.getElementById('editAddress').value = row[2];
            document.getElementById('editIncome').value = row[3];
            document.getElementById('editLoan').value = row[4];
            document.getElementById('editInterest').value = row[5];
            document.getElementById('editStatus').value = row[6];
            $('#editModal').modal('show');
            
            // Menyimpan index yang sedang diedit untuk update data setelah submit
            document.getElementById('editForm').onsubmit = function(event) {
                event.preventDefault();
                nasabahData[index + 1] = [
                    document.getElementById('editName').value,
                    document.getElementById('editJob').value,
                    document.getElementById('editAddress').value,
                    document.getElementById('editIncome').value,
                    document.getElementById('editLoan').value,
                    document.getElementById('editInterest').value,
                    document.getElementById('editStatus').value
                ];
                displayNasabahData(nasabahData);
                $('#editModal').modal('hide');
            };
        }

        // Fungsi untuk menghapus data
        function deleteData(index) {
            if (confirm("Yakin ingin menghapus data ini?")) {
                nasabahData.splice(index + 1, 1); // Hapus data dari array
                displayNasabahData(nasabahData); // Update table
            }
        }

        // Fungsi untuk menambah data nasabah
        document.getElementById('addForm').onsubmit = function(event) {
            event.preventDefault();

            const newNasabah = [
                document.getElementById('addName').value,
                document.getElementById('addJob').value,
                document.getElementById('addAddress').value,
                document.getElementById('addIncome').value,
                document.getElementById('addLoan').value,
                document.getElementById('addInterest').value,
                document.getElementById('addStatus').value
            ];

            nasabahData.push(newNasabah);
            displayNasabahData(nasabahData);
            $('#addModal').modal('hide');
        };

        // Panggil fungsi untuk memuat data ketika halaman dimuat
        document.addEventListener('DOMContentLoaded', loadExcelData);
    </script>
</body>
</html>
